<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Orbit - Conecta con tu tribu</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Conecta con personas que realmente resuenan contigo. La app de networking social m√°s inteligente.">
    <meta name="theme-color" content="#667eea">
    <meta name="background-color" content="#667eea">
    
    <!-- PWA Apple Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Orbit">
    
    <!-- PWA Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9InVybCgjZ3JhZGllbnQwKSIvPgo8dGV4dCB4PSIxNiIgeT0iMjIiIGZpbGw9IndoaXRlIiBmb250LXNpemU9IjE4IiBmb250LXdlaWdodD0iYm9sZCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+8J+MjDwvdGV4dD4KPHN2Zz4K">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxODAiIGhlaWdodD0iMTgwIiByeD0iNDAiIGZpbGw9InVybCgjZ3JhZGllbnQwKSIvPgo8dGV4dCB4PSI5MCIgeT0iMTEwIiBmaWxsPSJ3aGl0ZSIgZm9udC1zaXplPSI3MiIgZm9udC13ZWlnaHQ9ImJvbGQiIHRleHQtYW5jaG9yPSJtaWRkbGUiPvCfjIw8L3RleHQ+CjxkZWZzPgo8bGluZWFyR3JhZGllbnQgaWQ9ImdyYWRpZW50MCIgeDE9IjAiIHkxPSIwIiB4Mj0iMTgwIiB5Mj0iMTgwIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+CjxzdG9wIHN0b3AtY29sb3I9IiM2NjdlZWEiLz4KPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjNzY0YmEyIi8+CjwvbGluZWFyR3JhZGllbnQ+CjwvZGVmcz4KPHN2Zz4K">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIk9yYml0IC0gQ29uZWN0YSBjb24gdHUgdHJpYnUiLAogICJzaG9ydF9uYW1lIjogIk9yYml0IiwKICAiZGVzY3JpcHRpb24iOiAiQ29uZWN0YSBjb24gcGVyc29uYXMgcXVlIHJlYWxtZW50ZSByZXN1ZW5hbiBjb250aWdvLiBMYSBhcHAgZGUgbmV0d29ya2luZyBzb2NpYWwgbcOhcyBpbnRlbGlnZW50ZS4iLAogICJzdGFydF91cmwiOiAiLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzY2N2VlYSIsCiAgInRoZW1lX2NvbG9yIjogIiM2NjdlZWEiLAogICJvcmllbnRhdGlvbiI6ICJwb3J0cmFpdCIsCiAgImljb25zIjogWwogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU1UazJJaUJvWldsbmFIUTlJakU1TmlJZ2RtbGxkMEp2ZUQwaU1DQXdJREU1TmlBeE9UWWlJR1pwYkd3OUltNXZibVVpSUhodGJHNXpQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh5TURBd0wzTjJaeUkrUEdOcGNtTnNaU0JqZUQwaU9UZ2lJR041UFNJNU9DSWljajBpT1RnaUlHWnBiR3c5SW5WeWJDZ2paMkpoWkdsbGJuUXdLU0l2UGp4MFpYaDBJSGc5SVRJNU5pSWdlVDBpTVRNd0lpQm1hV3hzUFNKM2FHbDBaU0lnWm05dWRDMXphWHBsUFNJME1DSWdabTl1ZEMxM1pXbG5hSFE5SW1KdmJHUWlJSFJsZUhRdFlXNWphRzl5UFNKdGFXUmtiR1VpUGk0dFBDOTBaWGgwUGp4a1pXWnpQZ284YkdsdVpXRnlSM0poWkdsbGJuUWdhV1E5SW1keVlXUnBaVzUwTUNJZ2VERTlJakFpSUhreFBTSXdJaUI0TWowaU1UazJJaUI1TWowaU1UazJJaUJuY21Ga2FXVnVkRlZ1YVhSelBTSjFjMlZ5VTNCaFkyVlBibFZ6WlNJK1BITjBiM0FnYzNSdmNDMWpiMnh2Y2owaUl6WTJOM1ZsWVNJdlBqeHpkRzl3SUc5bVpuTmxkRDBpTVNJZ2MzUnZjQzFqYjJ4dmNqMGlJemMySUROaU1rSWlMejQ4TDJ4cGJtVmhja2R5WVdScFpXNTBQand2WkdWbWN6NEtQQzl6ZG1jKyIsCiAgICAgICJzaXplcyI6ICIxOTJ4MTkyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTlRFeUlpQm9aV2xuYUhROUlqVXhNaUlnZG1sbGQwSnZlRDBpTUNBd0lEVXhNaUExTVRJaUlHWnBiR3c5SW01dmJtVWlJSGh0Ykc1elBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHlNREF3TDNOMlp5SStQR05wY21Oc1pTQmplRDBpTWpVMklpQmplVDBpTWpVMklpQnlQU0l5TlRZaUlHWnBiR3c5SW5WeWJDZ2paMkpoWkdsbGJuUXdLU0l2UGp4MFpYaDBJSGc5SURRMU1pSWdlVDBpTkRBd0lpQm1hV3hzUFNKM2FHbDBaU0lnWm05dWRDMXphWHBsUFNJM01qSWlJR1p2Ym5RdGQyVnBaMmgwUFNKaWIyeGtJaUIwWlhoMExXRnVZMmh2Y2owaWJXbGtaR3hsUGlBdFBDOTBaWGgwUGp4a1pXWnpQZ284YkdsdVpXRnlSM0poWkdsbGJuUWdhV1E5SW1keVlXUnBaVzUwTUNJZ2VERTlJakFpSUhreFBTSXdJaUI0TWowaU5URXlJaUI1TWowaU5URXlJaUJuY21Ga2FXVnVkRlZ1YVhSelBTSjFjMlZ5VTNCaFkyVlBibFZ6WlNJK1BITjBiM0FnYzNSdmNDMWpiMnh2Y2owaUl6WTJOM1ZsWVNJdlBqeHpkRzl3SUc5bVpuTmxkRDBpTVNJZ2MzUnZjQzFqYjJ4dmNqMGlJemMySUROaU1rSWlMejQ4TDJ4cGJtVmhja2R5WVdScFpXNTBQand2WkdWbWN6NEtQQzl6ZG1jKyIsCiAgICAgICJzaXplcyI6ICI1MTJ4NTEyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0KICBdLAogICJjYXRlZ29yaWVzIjogWyJzb2NpYWwiLCAibmV0d29ya2luZyIsICJkYXRpbmciXSwKICAibGFuZyI6ICJlcyIsCiAgImRpcmVjdGlvbiI6ICJsdHIiCn0=">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        .app-container {
            max-width: 400px;
            margin: 0 auto;
            min-height: 100vh;
            background: white;
            position: relative;
            box-shadow: 0 0 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        /* PWA Install Banner */
        .pwa-install-banner {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 360px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 16px 20px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
            z-index: 2000;
            display: none;
            animation: slideUpFromBottom 0.4s ease-out;
        }

        .pwa-install-banner.show {
            display: block;
        }

        .install-banner-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .install-banner-icon {
            font-size: 24px;
        }

        .install-banner-title {
            font-size: 16px;
            font-weight: 600;
        }

        .install-banner-description {
            font-size: 14px;
            margin-bottom: 12px;
            opacity: 0.9;
        }

        .install-banner-actions {
            display: flex;
            gap: 8px;
        }

        .install-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .install-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .install-btn-secondary {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        /* Status Bar */
        .status-bar {
            height: 30px;
            background: #f8f9fa;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            font-size: 12px;
            font-weight: 600;
            position: fixed;
            width: 100%;
            max-width: 400px;
            top: 0;
            z-index: 1000;
        }

        /* Screen Management */
        .screen {
            min-height: 100vh;
            padding: 50px 20px 80px;
            display: none;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.4s cubic-bezier(0.4, 0.0, 0.2, 1);
        }

        .screen.active {
            display: block;
            opacity: 1;
            transform: translateX(0);
        }

        /* Notification Badge */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff4757;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            animation: pulse-notification 2s infinite;
        }

        /* Push Notification Toast */
        .push-notification-toast {
            position: fixed;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 360px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            padding: 16px;
            z-index: 2000;
            display: none;
            animation: slideInFromTop 0.4s ease-out;
        }

        .push-notification-toast.show {
            display: block;
        }

        .toast-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .toast-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
            background: linear-gradient(45deg, #667eea, #764ba2);
        }

        .toast-title {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
        }

        .toast-message {
            font-size: 14px;
            color: #4a5568;
            line-height: 1.4;
        }

        .toast-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .toast-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toast-btn-primary {
            background: #667eea;
            color: white;
        }

        .toast-btn-secondary {
            background: #f8f9fa;
            color: #4a5568;
        }

        /* Auth Screens */
        .auth-header {
            text-align: center;
            margin-bottom: 40px;
            padding-top: 20px;
        }

        .logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 40px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            animation: pulse 2s infinite;
        }

        .title {
            font-size: 32px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 16px;
            color: #718096;
            line-height: 1.5;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 16px;
            border: 2px solid transparent;
            border-radius: 12px;
            background: #f8f9fa;
            font-size: 16px;
            transition: all 0.3s ease;
            font-family: inherit;
            -webkit-appearance: none;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* Buttons */
        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
            margin-bottom: 8px;
            touch-action: manipulation;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:active {
            transform: scale(0.98);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-premium {
            background: linear-gradient(45deg, #feca57, #ff6b6b);
            color: white;
            box-shadow: 0 4px 15px rgba(254, 202, 87, 0.4);
        }

        .btn-success {
            background: linear-gradient(45deg, #48bb78, #38a169);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #f56565, #e53e3e);
            color: white;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Messages */
        .error-message, .success-message, .info-message {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            font-size: 14px;
        }

        .error-message {
            background: #fed7d7;
            color: #c53030;
        }

        .success-message {
            background: #c6f6d5;
            color: #22543d;
        }

        .info-message {
            background: #bee3f8;
            color: #2b6cb0;
        }

        /* Constellation View */
        .constellation-screen {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            padding: 60px 20px 100px;
        }

        .constellation-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .constellation-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .constellation-subtitle {
            font-size: 14px;
            opacity: 0.8;
        }

        .location-info {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .location-text {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .location-button {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .location-button:active {
            background: rgba(255,255,255,0.3);
            transform: scale(0.98);
        }

        .constellation-container {
            width: 100%;
            height: 350px;
            position: relative;
            background: radial-gradient(circle at center, rgba(102, 126, 234, 0.1) 0%, transparent 70%);
            border-radius: 20px;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .orbit-ring {
            position: absolute;
            border: 1px dashed rgba(102, 126, 234, 0.3);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: rotate 30s linear infinite;
        }

        .orbit-1 { width: 80px; height: 80px; }
        .orbit-2 { width: 140px; height: 140px; }
        .orbit-3 { width: 200px; height: 200px; }
        .orbit-4 { width: 260px; height: 260px; }

        .user-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #764ba2, #667eea);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 0 20px rgba(118, 75, 162, 0.6);
            animation: pulse-center 3s ease-in-out infinite;
            z-index: 10;
            border: 3px solid #4ecdc4;
        }

        .match-node {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 5;
            color: white;
        }

        .match-node:active {
            transform: scale(1.2);
            z-index: 15;
        }

        .match-node.intellectual {
            background: linear-gradient(45deg, #4299e1, #63b3ed);
            animation: float 4s ease-in-out infinite;
        }

        .match-node.emotional {
            background: linear-gradient(45deg, #f56565, #fc8181);
            animation: float 3.5s ease-in-out infinite;
        }

        .match-node.creative {
            background: linear-gradient(45deg, #9f7aea, #b794f6);
            animation: float 4.5s ease-in-out infinite;
        }

        .match-node.balanced {
            background: linear-gradient(45deg, #48bb78, #68d391);
            animation: float 3.8s ease-in-out infinite;
        }

        .compatibility-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            color: #333;
            font-weight: bold;
        }

        .distance-badge {
            position: absolute;
            bottom: -5px;
            left: -5px;
            background: #4ecdc4;
            color: white;
            border-radius: 8px;
            padding: 2px 6px;
            font-size: 8px;
            font-weight: bold;
        }

        .verified-badge {
            position: absolute;
            top: -5px;
            left: -5px;
            background: #48bb78;
            color: white;
            border-radius: 50%;
            width: 14px;
            height: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
        }

        .online-indicator {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 10px;
            height: 10px;
            background: #48bb78;
            border-radius: 50%;
            border: 2px solid white;
            animation: pulse-online 2s ease-in-out infinite;
        }

        /* Match Stats */
        .match-stats {
            display: flex;
            justify-content: space-around;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #4ecdc4;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.8;
        }

        /* Swipe Cards - Mobile Optimized */
        .swipe-container {
            position: relative;
            height: 500px;
            overflow: hidden;
            margin: 20px 0;
            touch-action: pan-y;
        }

        .swipe-card {
            position: absolute;
            width: 100%;
            height: 450px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            cursor: grab;
            transition: transform 0.3s ease;
            touch-action: pan-x pan-y;
        }

        .swipe-card:active {
            cursor: grabbing;
        }

        .swipe-card.swiped-right {
            transform: translateX(100%) rotate(30deg);
            opacity: 0;
        }

        .swipe-card.swiped-left {
            transform: translateX(-100%) rotate(-30deg);
            opacity: 0;
        }

        .card-photo {
            height: 60%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 72px;
            color: white;
            position: relative;
        }

        .card-verification {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(72, 187, 120, 0.9);
            color: white;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .card-distance {
            position: absolute;
            bottom: 15px;
            right: 15px;
            background: rgba(78, 205, 196, 0.9);
            color: white;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .card-info {
            padding: 20px;
            flex: 1;
        }

        .card-name {
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .card-details {
            color: #718096;
            margin-bottom: 12px;
        }

        .card-compatibility {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 12px;
        }

        .card-bio {
            font-size: 14px;
            color: #4a5568;
            line-height: 1.4;
        }

        .swipe-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .swipe-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-pass {
            background: #f56565;
            color: white;
        }

        .btn-super-like {
            background: #4299e1;
            color: white;
        }

        .btn-like {
            background: #48bb78;
            color: white;
        }

        .swipe-btn:active {
            transform: scale(1.1);
        }

        /* Chat System - Mobile Optimized */
        .chat-screen {
            padding: 50px 0 80px;
        }

        .chat-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #f1f3f4;
            background: white;
            position: sticky;
            top: 30px;
            z-index: 50;
        }

        .conversations-list {
            background: white;
        }

        .conversation-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid #f8f9fa;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            touch-action: manipulation;
        }

        .conversation-item:active {
            background: #f8f9fa;
        }

        .conversation-item.unread {
            background: #edf2ff;
        }

        .conversation-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            color: white;
            margin-right: 15px;
            flex-shrink: 0;
            position: relative;
        }

        .conversation-info {
            flex: 1;
            min-width: 0;
        }

        .conversation-name {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .conversation-preview {
            color: #718096;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .conversation-meta {
            text-align: right;
            flex-shrink: 0;
        }

        .conversation-time {
            font-size: 12px;
            color: #a0aec0;
            margin-bottom: 4px;
        }

        .unread-badge {
            background: #667eea;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
        }

        .compatibility-chip {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
        }

        /* Individual Chat - Mobile Optimized */
        .individual-chat-screen {
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .chat-top-header {
            background: white;
            border-bottom: 1px solid #f1f3f4;
            padding: 10px 20px;
            margin-top: 30px;
            display: flex;
            align-items: center;
            position: sticky;
            top: 30px;
            z-index: 60;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .chat-back-btn {
            background: none;
            border: none;
            font-size: 18px;
            color: #667eea;
            cursor: pointer;
            padding: 8px;
            margin-right: 15px;
            border-radius: 8px;
            transition: background 0.3s ease;
        }

        .chat-back-btn:active {
            background: #f8f9fa;
        }

        .chat-user-info {
            flex: 1;
            display: flex;
            align-items: center;
        }

        .chat-user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            color: white;
            margin-right: 12px;
            position: relative;
        }

        .chat-user-details h3 {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
            margin: 0;
        }

        .chat-user-status {
            font-size: 12px;
            color: #718096;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .online-dot {
            width: 6px;
            height: 6px;
            background: #48bb78;
            border-radius: 50%;
            animation: pulse-online 2s ease-in-out infinite;
        }

        .chat-actions {
            display: flex;
            gap: 10px;
        }

        .chat-action-btn {
            background: none;
            border: none;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 18px;
        }

        .chat-action-btn:active {
            background: #f8f9fa;
        }

        .video-call-btn {
            color: #667eea;
        }

        .chat-messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
            display: flex;
            flex-direction: column;
            gap: 12px;
            -webkit-overflow-scrolling: touch;
        }

        .message-bubble {
            max-width: 75%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 15px;
            line-height: 1.4;
            position: relative;
            animation: messageSlideIn 0.3s ease-out;
        }

        .message-bubble.own {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
            margin-left: auto;
        }

        .message-bubble.other {
            background: white;
            color: #2d3748;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .message-time {
            font-size: 11px;
            opacity: 0.7;
            margin-top: 4px;
            text-align: right;
        }

        .message-time.other {
            text-align: left;
            color: #718096;
        }

        .message-status {
            font-size: 10px;
            opacity: 0.7;
            margin-top: 2px;
        }

        .chat-input-container {
            background: white;
            border-top: 1px solid #f1f3f4;
            padding: 15px 20px;
            margin-bottom: 80px;
            display: flex;
            align-items: flex-end;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            padding: 12px 16px;
            font-size: 16px;
            max-height: 80px;
            min-height: 40px;
            resize: none;
            font-family: inherit;
            background: #f8f9fa;
            transition: all 0.3s ease;
            -webkit-appearance: none;
        }

        .chat-input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .chat-send-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .chat-send-btn:active:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .chat-send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .chat-send-btn svg {
            width: 18px;
            height: 18px;
            fill: white;
        }

        /* Bottom Navigation - Mobile Optimized */
        .nav-bottom {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 400px;
            background: white;
            border-top: 1px solid #f1f3f4;
            display: flex;
            padding: 10px 0;
            z-index: 100;
            safe-area-inset-bottom: env(safe-area-inset-bottom);
        }

        .nav-item {
            flex: 1;
            text-align: center;
            padding: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #718096;
            position: relative;
            touch-action: manipulation;
        }

        .nav-item.active {
            color: #667eea;
        }

        .nav-item:active {
            transform: scale(0.95);
        }

        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
            position: relative;
        }

        .nav-label {
            font-size: 10px;
            font-weight: 500;
        }

        /* Profile Screen */
        .profile-header {
            text-align: center;
            margin-bottom: 30px;
            padding-top: 20px;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: white;
            font-weight: bold;
        }

        .profile-name {
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 4px;
        }

        .profile-age {
            font-size: 16px;
            color: #718096;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .personality-section {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .verification-chip {
            background: #fed7d7;
            color: #c53030;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .personality-trait {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .trait-name {
            font-size: 14px;
            font-weight: 500;
            color: #4a5568;
            min-width: 80px;
        }

        .trait-bar {
            flex: 1;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }

        .trait-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .trait-value {
            font-size: 14px;
            font-weight: 600;
            color: #667eea;
            min-width: 30px;
            text-align: right;
        }

        .insight-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border-left: 4px solid #667eea;
        }

        .insight-text {
            font-size: 14px;
            color: #4a5568;
            line-height: 1.5;
        }

        /* Notification Settings */
        .notification-settings {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .settings-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .settings-icon {
            font-size: 24px;
        }

        .settings-title {
            font-size: 18px;
            font-weight: 600;
            color: #2d3748;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid #f1f3f4;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-info {
            flex: 1;
        }

        .setting-name {
            font-size: 16px;
            font-weight: 500;
            color: #2d3748;
            margin-bottom: 4px;
        }

        .setting-description {
            font-size: 14px;
            color: #718096;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 28px;
            background: #e2e8f0;
            border-radius: 14px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .toggle-switch.active {
            background: #667eea;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(22px);
        }

        /* Loading Spinner */
        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-left: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Animations */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes pulse-center {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(118, 75, 162, 0.6);
                transform: translate(-50%, -50%) scale(1);
            }
            50% { 
                box-shadow: 0 0 40px rgba(118, 75, 162, 1);
                transform: translate(-50%, -50%) scale(1.1);
            }
        }

        @keyframes pulse-online {
            0%, 100% { 
                opacity: 1;
                transform: scale(1);
            }
            50% { 
                opacity: 0.8;
                transform: scale(1.1);
            }
        }

        @keyframes pulse-notification {
            0%, 100% { 
                transform: scale(1);
            }
            50% { 
                transform: scale(1.2);
            }
        }

        @keyframes rotate {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }

        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes slideInFromTop {
            from {
                transform: translateX(-50%) translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        @keyframes slideUpFromBottom {
            from {
                transform: translateX(-50%) translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Mobile Responsive */
        @media (max-width: 480px) {
            .app-container {
                max-width: 100%;
                margin: 0;
            }
            
            .message-bubble {
                max-width: 85%;
            }

            .swipe-actions {
                gap: 15px;
            }

            .swipe-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
        }

        /* iOS Safe Area */
        @supports (padding: max(0px)) {
            .nav-bottom {
                padding-bottom: max(10px, env(safe-area-inset-bottom));
            }
            
            .chat-input-container {
                margin-bottom: max(80px, calc(80px + env(safe-area-inset-bottom)));
            }
        }

        /* Scroll styling */
        .chat-messages-container::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .chat-messages-container::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 3px;
        }

        .chat-messages-container::-webkit-scrollbar-thumb:hover {
            background: #a0aec0;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Status Bar -->
        <div class="status-bar">
            <span>9:41</span>
            <span>‚óè‚óè‚óè‚óã‚óã</span>
            <span>100%</span>
        </div>

        <!-- PWA Install Banner -->
        <div class="pwa-install-banner" id="pwaInstallBanner">
            <div class="install-banner-header">
                <div class="install-banner-icon">üì±</div>
                <div class="install-banner-title">¬°Instala Orbit!</div>
            </div>
            <div class="install-banner-description">Accede m√°s r√°pido y recibe notificaciones push</div>
            <div class="install-banner-actions">
                <button class="install-btn" id="installPwaBtn">Instalar</button>
                <button class="install-btn install-btn-secondary" onclick="hidePwaInstallBanner()">M√°s tarde</button>
            </div>
        </div>

        <!-- Push Notification Toast -->
        <div class="push-notification-toast" id="pushNotificationToast">
            <div class="toast-header">
                <div class="toast-icon" id="toastIcon">üí¨</div>
                <div class="toast-title" id="toastTitle">Nuevo mensaje</div>
            </div>
            <div class="toast-message" id="toastMessage">Ana M. te ha enviado un mensaje</div>
            <div class="toast-actions">
                <button class="toast-btn toast-btn-primary" id="toastActionBtn">Ver mensaje</button>
                <button class="toast-btn toast-btn-secondary" onclick="hideToast()">Cerrar</button>
            </div>
        </div>

        <!-- Login Screen -->
        <div class="screen active" id="loginScreen">
            <div class="auth-header">
                <div class="logo">üåå</div>
                <h1 class="title">Bienvenido a Orbit</h1>
                <p class="subtitle">Conecta con personas que realmente resuenan contigo</p>
            </div>

            <div id="loginError" class="error-message" style="display: none;"></div>

            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="loginEmail" placeholder="demo@orbit.com" required autocomplete="email">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Contrase√±a</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="123456" required autocomplete="current-password">
                </div>

                <button type="submit" class="btn btn-primary" id="loginBtn">
                    Iniciar Sesi√≥n
                </button>
            </form>

            <div class="auth-footer">
                ¬øNo tienes cuenta? 
                <span class="auth-link" id="goToRegister">Reg√≠strate</span>
            </div>
        </div>

        <!-- Main App Screen -->
        <div class="screen constellation-screen" id="mainScreen">
            <div class="constellation-header">
                <h2 class="constellation-title">Tu Constelaci√≥n Personal</h2>
                <p class="constellation-subtitle">Personas gravitando hacia tu √≥rbita</p>
            </div>

            <div class="location-info" id="locationInfo">
                <div class="location-text" id="locationText">
                    üìç Ubicaci√≥n: Detectando...
                </div>
                <button class="location-button" onclick="requestLocation()">
                    üìç Activar ubicaci√≥n
                </button>
            </div>

            <div class="match-stats">
                <div class="stat-item">
                    <div class="stat-number" id="totalMatches">8</div>
                    <div class="stat-label">Matches</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="avgCompatibility">78</div>
                    <div class="stat-label">% Promedio</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="nearbyCount">4</div>
                    <div class="stat-label">Cerca de ti</div>
                </div>
            </div>

            <div class="constellation-container" id="constellationContainer">
                <div class="orbit-ring orbit-1"></div>
                <div class="orbit-ring orbit-2"></div>
                <div class="orbit-ring orbit-3"></div>
                <div class="orbit-ring orbit-4"></div>
                <div class="user-center">T√ö</div>
            </div>
        </div>

        <!-- Discover Screen -->
        <div class="screen" id="discoverScreen">
            <div style="padding-top: 20px;">
                <h2 class="title">üîç Descubrir</h2>
                <p class="subtitle" style="margin-bottom: 20px;">Encuentra nuevas conexiones</p>

                <div class="swipe-container" id="swipeContainer">
                    <!-- Swipe cards will be inserted here -->
                </div>

                <div class="swipe-actions">
                    <button class="swipe-btn btn-pass" onclick="passCard()">‚ùå</button>
                    <button class="swipe-btn btn-super-like" onclick="superLikeCard()">‚≠ê</button>
                    <button class="swipe-btn btn-like" onclick="likeCard()">‚ù§Ô∏è</button>
                </div>
            </div>
        </div>

        <!-- Chat Screen -->
        <div class="screen chat-screen" id="chatScreen">
            <div class="chat-header">
                <h2 class="title">üí¨ Conversaciones</h2>
                <p class="subtitle">Conecta con tus matches</p>
            </div>

            <div class="conversations-list" id="conversationsList">
                <!-- Conversations will be populated here -->
            </div>
        </div>

        <!-- Individual Chat Screen -->
        <div class="screen individual-chat-screen" id="individualChatScreen">
            <div class="chat-top-header">
                <button class="chat-back-btn" id="backToChatBtn">‚Üê</button>
                <div class="chat-user-info">
                    <div class="chat-user-avatar" id="chatUserAvatar"></div>
                    <div class="chat-user-details">
                        <h3 id="chatUserName"></h3>
                        <div class="chat-user-status" id="chatUserStatus">
                            <span class="online-dot"></span>
                            En l√≠nea
                        </div>
                    </div>
                </div>
                <div class="chat-actions">
                    <button class="chat-action-btn video-call-btn" id="videoCallBtn" title="Video llamada">
                        üìπ
                    </button>
                </div>
            </div>

            <div class="chat-messages-container" id="chatMessagesContainer">
                <!-- Messages will be populated here -->
            </div>

            <div class="chat-input-container">
                <textarea 
                    class="chat-input" 
                    id="chatInput" 
                    placeholder="Escribe un mensaje..."
                    rows="1"
                ></textarea>
                <button class="chat-send-btn" id="chatSendBtn">
                    <svg viewBox="0 0 24 24">
                        <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Profile Screen -->
        <div class="screen" id="profileScreen">
            <div class="profile-header">
                <div class="profile-avatar" id="profileAvatar">AD</div>
                <h2 class="profile-name" id="profileName">Alex Demo</h2>
                <p class="profile-age" id="profileAge">27 a√±os</p>
            </div>

            <div class="personality-section">
                <h3 class="section-title">üõ°Ô∏è Verificaci√≥n de perfil</h3>
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                    <div id="verificationStatus" class="verification-chip">
                        ‚ùå No verificado
                    </div>
                    <button class="btn btn-success" onclick="simulateVerification()" style="padding: 8px 16px; font-size: 14px;">
                        Verificar ahora
                    </button>
                </div>
            </div>

            <!-- Notification Settings -->
            <div class="notification-settings">
                <div class="settings-header">
                    <span class="settings-icon">üîî</span>
                    <h3 class="settings-title">Configuraci√≥n de Notificaciones</h3>
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-name">Nuevos mensajes</div>
                        <div class="setting-description">Recibe notificaciones cuando alguien te escriba</div>
                    </div>
                    <div class="toggle-switch active" data-setting="newMessages" onclick="toggleNotificationSetting(this)">
                        <div class="toggle-slider"></div>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-name">Nuevos matches</div>
                        <div class="setting-description">Notificaciones cuando tengas un match</div>
                    </div>
                    <div class="toggle-switch active" data-setting="newMatches" onclick="toggleNotificationSetting(this)">
                        <div class="toggle-slider"></div>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-name">Eventos cercanos</div>
                        <div class="setting-description">Eventos y actividades cerca de ti</div>
                    </div>
                    <div class="toggle-switch active" data-setting="nearbyEvents" onclick="toggleNotificationSetting(this)">
                        <div class="toggle-slider"></div>
                    </div>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-name">Recordatorios diarios</div>
                        <div class="setting-description">Recordatorio para revisar nuevos perfiles</div>
                    </div>
                    <div class="toggle-switch" data-setting="dailyReminders" onclick="toggleNotificationSetting(this)">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
            </div>

            <div class="personality-section">
                <h3 class="section-title">üß† Tu personalidad</h3>
                <div id="personalityTraits"></div>
            </div>

            <div class="personality-section">
                <h3 class="section-title">üí° Insights sobre ti</h3>
                <div id="personalityInsights"></div>
            </div>

            <div class="personality-section">
                <h3 class="section-title">‚öôÔ∏è Acciones</h3>
                <button class="btn btn-secondary" onclick="testNotifications()">
                    üîî Probar notificaciones
                </button>
                <button class="btn btn-secondary" onclick="showPwaInstallBanner()">
                    üì± Instalar App
                </button>
                <button class="btn btn-secondary" id="logoutBtn">
                    Cerrar sesi√≥n
                </button>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="nav-bottom" id="bottomNav" style="display: none;">
            <div class="nav-item" data-tab="mainScreen">
                <div class="nav-icon">üåå</div>
                <div class="nav-label">Inicio</div>
            </div>
            <div class="nav-item" data-tab="discoverScreen">
                <div class="nav-icon">üîç</div>
                <div class="nav-label">Descubrir</div>
            </div>
            <div class="nav-item" data-tab="chatScreen">
                <div class="nav-icon">
                    üí¨
                    <div class="notification-badge" id="chatNotificationBadge" style="display: none;">3</div>
                </div>
                <div class="nav-label">Chat</div>
            </div>
            <div class="nav-item" data-tab="profileScreen">
                <div class="nav-icon">üë§</div>
                <div class="nav-label">Perfil</div>
            </div>
        </div>
    </div>

    <script>
        // ===== VARIABLES GLOBALES =====
        let currentUser = null;
        let conversations = {};
        let currentChatUserId = null;
        let currentCardIndex = 0;
        let userLocation = null;
        let deferredPrompt = null; // Para PWA install
        
        // Push Notifications
        let notificationPermission = 'default';
        let serviceWorkerRegistration = null;
        let notificationSettings = {
            newMessages: true,
            newMatches: true,
            nearbyEvents: true,
            dailyReminders: false
        };
        
        // Almacenamiento en memoria
        let memoryStorage = {
            orbitUsers: [],
            currentUser: null,
            conversations: {},
            userSettings: {},
            notificationSettings: notificationSettings
        };

        // ===== DATOS DE LA APLICACI√ìN =====
        const mockUsers = [
            {
                id: 1,
                name: 'Ana M.',
                age: 26,
                initials: 'AM',
                compatibility: 94,
                connectionType: 'emotional',
                isOnline: true,
                bio: 'Amante de las conversaciones profundas y los atardeceres. Psic√≥loga en formaci√≥n con pasi√≥n por entender las conexiones humanas.',
                location: { lat: 41.3874, lng: 2.1686, name: 'Barcelona, Espa√±a' },
                distance: 2.3,
                verified: true,
                icebreaker: 'Hola Ana! Vi que tambi√©n crees que las mejores conversaciones surgen de las preguntas m√°s simples. ¬øCu√°l ha sido la pregunta que m√°s te ha cambiado la perspectiva?'
            },
            {
                id: 2,
                name: 'Carlos R.',
                age: 29,
                initials: 'CR',
                compatibility: 87,
                connectionType: 'intellectual',
                isOnline: false,
                bio: 'Ingeniero de software obsesionado con la IA y el futuro. Me encantan los debates filos√≥ficos y los proyectos side que cambien el mundo.',
                location: { lat: 41.3851, lng: 2.1734, name: 'Barcelona, Espa√±a' },
                distance: 1.8,
                verified: true,
                icebreaker: 'Carlos, me intriga tu enfoque anal√≠tico. ¬øHay alg√∫n tema complejo en el que te encante perderte durante horas?'
            },
            {
                id: 3,
                name: 'Mar√≠a L.',
                age: 24,
                initials: 'ML',
                compatibility: 83,
                connectionType: 'creative',
                isOnline: true,
                bio: 'Artista digital y dise√±adora. Creo que la creatividad es el lenguaje universal que conecta almas. Siempre buscando inspiraci√≥n en lo cotidiano.',
                location: { lat: 41.3888, lng: 2.1590, name: 'Barcelona, Espa√±a' },
                distance: 3.1,
                verified: false,
                icebreaker: '¬°Hola Mar√≠a! Vi que tambi√©n eres una persona creativa. ¬øEn qu√© proyecto personal has estado trabajando √∫ltimamente?'
            }
        ];

        // Respuestas autom√°ticas de IA
        const aiResponses = {
            1: [
                "Me encanta esa pregunta! Creo que fue cuando alguien me pregunt√≥ '¬øQu√© har√≠as si supieras que no puedes fallar?' Cambi√≥ toda mi perspectiva sobre el miedo.",
                "Qu√© interesante que menciones eso. Para m√≠ las conversaciones m√°s profundas siempre empiezan con algo simple como '¬øC√≥mo fue tu d√≠a realmente?' ",
                "Tienes raz√≥n sobre la autenticidad. Me parece que vivimos en una √©poca donde la superficialidad es la norma, pero las conexiones reales son tan raras y valiosas."
            ],
            2: [
                "¬°Exacto! √öltimamente me he estado perdiendo en el tema de la consciencia artificial. Es fascinante pensar en qu√© punto una m√°quina podr√≠a considerarse realmente 'consciente'.",
                "Me parece incre√≠ble c√≥mo podemos conectar tan f√°cilmente en estas ideas. ¬øHas le√≠do algo interesante sobre neurociencia √∫ltimamente?",
                "Los debates profundos son mi debilidad. Creo que es la mejor manera de realmente conocer a alguien: ver c√≥mo piensa sobre los grandes temas."
            ],
            3: [
                "¬°Gracias! Ahora mismo estoy trabajando en una serie de fotograf√≠as urbanas que capturan momentos de soledad en multitudes. Es muy terap√©utico.",
                "Me encanta encontrar a alguien que tambi√©n valore la creatividad. ¬øTienes alg√∫n proyecto personal que te apasione?",
                "Para m√≠ la creatividad es como respirar. Siempre estoy viendo el mundo como una galer√≠a de arte esperando ser descubierta."
            ]
        };

        // ===== PWA FUNCTIONALITY =====
        
        // Listen for beforeinstallprompt event
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('üì± PWA install prompt available');
            e.preventDefault();
            deferredPrompt = e;
            
            // Show custom install banner after 3 seconds
            setTimeout(() => {
                showPwaInstallBanner();
            }, 3000);
        });

        // Install PWA
        async function installPWA() {
            if (!deferredPrompt) {
                console.log('‚ùå No PWA install prompt available');
                showToast('üì± Instalaci√≥n PWA', 'Usa "A√±adir a pantalla de inicio" desde el men√∫ del navegador');
                return;
            }

            try {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    console.log('‚úÖ PWA installed successfully');
                    showNotification('üéâ ¬°Orbit instalado!', {
                        body: 'La app est√° ahora disponible en tu pantalla de inicio',
                        icon: 'üì±',
                        tag: 'pwa-installed'
                    });
                } else {
                    console.log('‚ùå PWA installation declined');
                }
                
                deferredPrompt = null;
                hidePwaInstallBanner();
                
            } catch (error) {
                console.error('‚ùå Error installing PWA:', error);
            }
        }

        function showPwaInstallBanner() {
            const banner = document.getElementById('pwaInstallBanner');
            banner.classList.add('show');
        }

        function hidePwaInstallBanner() {
            const banner = document.getElementById('pwaInstallBanner');
            banner.classList.remove('show');
        }

        // Register Service Worker
        async function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                try {
                    // Create service worker content as blob
                    const swContent = `
                        const CACHE_NAME = 'orbit-v1';
                        const urlsToCache = [
                            '/',
                            '/manifest.json'
                        ];

                        self.addEventListener('install', (event) => {
                            event.waitUntil(
                                caches.open(CACHE_NAME)
                                    .then((cache) => cache.addAll(urlsToCache))
                            );
                        });

                        self.addEventListener('fetch', (event) => {
                            event.respondWith(
                                caches.match(event.request)
                                    .then((response) => {
                                        if (response) {
                                            return response;
                                        }
                                        return fetch(event.request);
                                    })
                            );
                        });

                        self.addEventListener('push', (event) => {
                            const options = {
                                body: event.data ? event.data.text() : 'Nueva notificaci√≥n de Orbit',
                                icon: '/icon-192x192.png',
                                badge: '/icon-96x96.png',
                                vibrate: [200, 100, 200],
                                data: {
                                    dateOfArrival: Date.now(),
                                    primaryKey: 1
                                }
                            };

                            event.waitUntil(
                                self.registration.showNotification('Orbit', options)
                            );
                        });
                    `;
                    
                    const swBlob = new Blob([swContent], { type: 'application/javascript' });
                    const swUrl = URL.createObjectURL(swBlob);
                    
                    const registration = await navigator.serviceWorker.register(swUrl);
                    serviceWorkerRegistration = registration;
                    console.log('‚úÖ Service Worker registered successfully');
                    return true;
                } catch (error) {
                    console.error('‚ùå Service Worker registration failed:', error);
                    return false;
                }
            }
            return false;
        }

        // ===== SISTEMA DE NOTIFICACIONES PUSH =====
        
        // Solicitar permisos de notificaci√≥n
        async function requestNotificationPermission() {
            if (!('Notification' in window)) {
                showToast('‚ùå Error', 'Este navegador no soporta notificaciones');
                return false;
            }

            try {
                const permission = await Notification.requestPermission();
                notificationPermission = permission;
                
                if (permission === 'granted') {
                    console.log('‚úÖ Permisos de notificaci√≥n concedidos');
                    
                    // Mostrar notificaci√≥n de bienvenida
                    showNotification('üåå ¬°Notificaciones activadas!', {
                        body: 'Ahora recibir√°s notificaciones sobre nuevos matches y mensajes',
                        icon: 'üîî',
                        tag: 'welcome'
                    });
                    
                    // Programar notificaciones autom√°ticas
                    scheduleAutoNotifications();
                    
                    return true;
                } else {
                    console.log('‚ùå Permisos de notificaci√≥n denegados');
                    return false;
                }
            } catch (error) {
                console.error('‚ùå Error solicitando permisos:', error);
                return false;
            }
        }

        // Mostrar notificaci√≥n
        function showNotification(title, options = {}) {
            if (notificationPermission !== 'granted') {
                console.log('‚ö†Ô∏è No hay permisos para mostrar notificaciones');
                showToast(title, options.body, options);
                return;
            }

            const defaultOptions = {
                icon: options.icon || 'üåå',
                badge: 'üåå',
                vibrate: [200, 100, 200],
                requireInteraction: false,
                tag: options.tag || 'orbit-notification',
                ...options
            };

            try {
                const notification = new Notification(title, defaultOptions);
                
                notification.onclick = function(event) {
                    event.preventDefault();
                    window.focus();
                    
                    // Manejar clicks seg√∫n el tipo de notificaci√≥n
                    if (options.action) {
                        handleNotificationClick(options.action, options.data);
                    }
                    
                    notification.close();
                };

                // Auto-cerrar despu√©s de 5 segundos
                setTimeout(() => {
                    notification.close();
                }, 5000);
                
            } catch (error) {
                console.error('‚ùå Error mostrando notificaci√≥n:', error);
                // Fallback: mostrar toast en la app
                showToast(title, options.body, options);
            }
        }

        // Toast en la aplicaci√≥n (fallback)
        function showToast(title, message, options = {}) {
            const toast = document.getElementById('pushNotificationToast');
            const toastIcon = document.getElementById('toastIcon');
            const toastTitle = document.getElementById('toastTitle');
            const toastMessage = document.getElementById('toastMessage');
            const toastActionBtn = document.getElementById('toastActionBtn');
            
            toastIcon.textContent = options.icon || 'üîî';
            toastTitle.textContent = title;
            toastMessage.textContent = message;
            
            if (options.action) {
                toastActionBtn.style.display = 'block';
                toastActionBtn.onclick = () => {
                    handleNotificationClick(options.action, options.data);
                    hideToast();
                };
            } else {
                toastActionBtn.style.display = 'none';
            }
            
            toast.classList.add('show');
            
            // Auto-ocultar despu√©s de 5 segundos
            setTimeout(() => {
                hideToast();
            }, 5000);
        }

        function hideToast() {
            const toast = document.getElementById('pushNotificationToast');
            toast.classList.remove('show');
        }

        // Manejar clicks en notificaciones
        function handleNotificationClick(action, data) {
            switch (action) {
                case 'openChat':
                    if (data && data.userId) {
                        openIndividualChat(data.userId);
                    } else {
                        showScreen('chatScreen');
                    }
                    break;
                case 'openMatch':
                    showScreen('discoverScreen');
                    break;
                default:
                    showScreen('mainScreen');
            }
        }

        // Programar notificaciones autom√°ticas
        function scheduleAutoNotifications() {
            // Simular nuevos mensajes cada 20 segundos (para demo)
            setInterval(() => {
                if (notificationSettings.newMessages && Math.random() < 0.3) {
                    simulateNewMessageNotification();
                }
            }, 20000);
            
            // Simular nuevos matches cada minuto
            setInterval(() => {
                if (notificationSettings.newMatches && Math.random() < 0.2) {
                    simulateMatchNotification();
                }
            }, 60000);
        }

        // Simular notificaciones para demo
        function simulateNewMessageNotification() {
            const activeUsers = mockUsers.filter(u => u.isOnline);
            if (activeUsers.length === 0) return;
            
            const randomUser = activeUsers[Math.floor(Math.random() * activeUsers.length)];
            const messages = [
                '¬°Hola! ¬øC√≥mo est√°s?',
                'Me encant√≥ tu perfil üòä',
                '¬øTienes planes para el fin de semana?',
                'Qu√© interesante lo que dijiste sobre...',
                'Acabas de aparecer en mi mente üí≠'
            ];
            
            const randomMessage = messages[Math.floor(Math.random() * messages.length)];
            
            showNotification(`üí¨ ${randomUser.name}`, {
                body: randomMessage,
                icon: 'üí¨',
                action: 'openChat',
                data: { userId: randomUser.id },
                tag: `message-${randomUser.id}`
            });
            
            // Actualizar badge de chat
            updateChatBadge();
        }

        function simulateMatchNotification() {
            const availableUsers = mockUsers.filter(u => !conversations[u.id]);
            if (availableUsers.length === 0) return;
            
            const newMatch = availableUsers[Math.floor(Math.random() * availableUsers.length)];
            
            showNotification(`üéâ ¬°Nuevo Match!`, {
                body: `Tienes ${newMatch.compatibility}% compatibilidad con ${newMatch.name}`,
                icon: '‚ù§Ô∏è',
                action: 'openMatch',
                data: { userId: newMatch.id },
                tag: `match-${newMatch.id}`
            });
            
            // Crear conversaci√≥n
            conversations[newMatch.id] = {
                userId: newMatch.id,
                messages: [],
                lastMessageTime: new Date().toISOString(),
                unreadCount: 0
            };
        }

        // Configuraci√≥n de notificaciones
        function toggleNotificationSetting(toggle) {
            const setting = toggle.dataset.setting;
            const isActive = toggle.classList.contains('active');
            
            if (isActive) {
                toggle.classList.remove('active');
                notificationSettings[setting] = false;
            } else {
                toggle.classList.add('active');
                notificationSettings[setting] = true;
            }
            
            // Guardar configuraci√≥n
            setStorage('notificationSettings', JSON.stringify(notificationSettings));
            
            console.log(`üîî Configuraci√≥n de ${setting}: ${notificationSettings[setting]}`);
        }

        // Cargar configuraci√≥n de notificaciones
        function loadNotificationSettings() {
            const saved = getStorage('notificationSettings');
            if (saved && saved !== 'null') {
                try {
                    notificationSettings = { ...notificationSettings, ...JSON.parse(saved) };
                } catch (e) {
                    console.log('Error cargando configuraci√≥n de notificaciones');
                }
            }
            
            // Aplicar configuraci√≥n a los toggles
            Object.keys(notificationSettings).forEach(setting => {
                const toggle = document.querySelector(`[data-setting="${setting}"]`);
                if (toggle) {
                    if (notificationSettings[setting]) {
                        toggle.classList.add('active');
                    } else {
                        toggle.classList.remove('active');
                    }
                }
            });
        }

        // Probar notificaciones
        function testNotifications() {
            if (notificationPermission !== 'granted') {
                requestNotificationPermission();
                return;
            }
            
            const testNotifications = [
                {
                    title: 'üí¨ Mensaje de Ana M.',
                    body: 'Hola! ¬øC√≥mo ha ido tu d√≠a?',
                    icon: 'üí¨',
                    action: 'openChat',
                    data: { userId: 1 }
                },
                {
                    title: 'üéâ ¬°Nuevo Match!',
                    body: 'Tienes 87% compatibilidad con Carlos R.',
                    icon: '‚ù§Ô∏è',
                    action: 'openMatch'
                }
            ];
            
            testNotifications.forEach((notif, index) => {
                setTimeout(() => {
                    showNotification(notif.title, notif);
                }, index * 2000);
            });
        }

        // ===== FUNCIONES DE STORAGE =====
        function getStorage(key) {
            try {
                if (typeof localStorage !== 'undefined' && localStorage) {
                    return localStorage.getItem(key);
                }
            } catch (e) {
                console.log('LocalStorage no disponible, usando memoria');
            }
            
            return JSON.stringify(memoryStorage[key] || null);
        }
        
        function setStorage(key, value) {
            try {
                if (typeof localStorage !== 'undefined' && localStorage) {
                    localStorage.setItem(key, value);
                    return;
                }
            } catch (e) {
                console.log('LocalStorage no disponible, usando memoria');
            }
            
            try {
                memoryStorage[key] = JSON.parse(value);
            } catch (e) {
                memoryStorage[key] = value;
            }
        }

        // ===== FUNCIONES PRINCIPALES =====
        function createDemoUser() {
            const demoUser = {
                id: 'demo-user',
                firstName: 'Alex',
                lastName: 'Demo',
                age: 27,
                email: 'demo@orbit.com',
                password: '123456',
                bio: 'Explorando las conexiones humanas aut√©nticas. Creo en el poder de la tecnolog√≠a para acercarnos.',
                personalityData: {
                    openness: 85,
                    conscientiousness: 70,
                    extraversion: 75,
                    agreeableness: 80,
                    stability: 75
                },
                insights: [
                    'Te energizas tanto en soledad como en compa√±√≠a, mostrando un equilibrio perfecto entre introspecci√≥n y conexi√≥n social.',
                    'Tu alta apertura te convierte en una persona curiosa que disfruta explorando nuevas ideas y perspectivas creativas.',
                    'Tienes una fuerte tendencia hacia la armon√≠a interpersonal y valoras profundamente las conexiones aut√©nticas.'
                ],
                verified: false,
                subscriptionType: 'free',
                onboardingCompleted: true,
                createdAt: new Date().toISOString()
            };

            let usersData = getStorage('orbitUsers') || '[]';
            let users;
            
            try {
                users = JSON.parse(usersData);
            } catch (e) {
                users = [];
            }
            
            const existingUserIndex = users.findIndex(u => u.email === demoUser.email);
            if (existingUserIndex >= 0) {
                users[existingUserIndex] = demoUser;
            } else {
                users.push(demoUser);
            }
            
            setStorage('orbitUsers', JSON.stringify(users));
            return demoUser;
        }

        function createDemoConversations() {
            const demoConversations = {
                1: {
                    userId: 1,
                    messages: [
                        {
                            id: 'msg1',
                            text: '¬°Hola! Me encanta tu perspectiva sobre las conexiones aut√©nticas.',
                            isOwn: false,
                            timestamp: new Date(Date.now() - 3600000).toISOString(),
                            read: true,
                            status: 'delivered'
                        },
                        {
                            id: 'msg2',
                            text: '¬°Hola Ana! Gracias, me alegra conocer a alguien que valora la autenticidad.',
                            isOwn: true,
                            timestamp: new Date(Date.now() - 3400000).toISOString(),
                            read: true,
                            status: 'read'
                        }
                    ],
                    lastMessageTime: new Date(Date.now() - 3400000).toISOString(),
                    unreadCount: 0
                },
                2: {
                    userId: 2,
                    messages: [
                        {
                            id: 'msg4',
                            text: 'Hola! Me intriga tu enfoque anal√≠tico. ¬øEn qu√© proyectos trabajas?',
                            isOwn: false,
                            timestamp: new Date(Date.now() - 7200000).toISOString(),
                            read: false,
                            status: 'delivered'
                        }
                    ],
                    lastMessageTime: new Date(Date.now() - 7200000).toISOString(),
                    unreadCount: 1
                }
            };

            conversations = demoConversations;
            setStorage('conversations', JSON.stringify(conversations));
            updateChatBadge();
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.classList.add('active');
            }

            const bottomNav = document.getElementById('bottomNav');
            const mainScreens = ['mainScreen', 'discoverScreen', 'chatScreen', 'profileScreen'];
            
            if (mainScreens.includes(screenId)) {
                bottomNav.style.display = 'flex';
                updateActiveTab(screenId);
                
                if (screenId === 'chatScreen') {
                    updateConversationsList();
                } else if (screenId === 'discoverScreen') {
                    setTimeout(() => initializeSwipeCards(), 100);
                } else if (screenId === 'mainScreen') {
                    generateConstellation();
                    updateStats();
                } else if (screenId === 'profileScreen') {
                    updateVerificationStatus();
                    loadNotificationSettings();
                }
            } else {
                bottomNav.style.display = 'none';
            }
        }

        function updateActiveTab(activeScreenId) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            const mapping = {
                'mainScreen': 0,
                'discoverScreen': 1,
                'chatScreen': 2,
                'profileScreen': 3
            };

            const activeIndex = mapping[activeScreenId];
            if (activeIndex !== undefined) {
                document.querySelectorAll('.nav-item')[activeIndex].classList.add('active');
            }
        }

        function executeLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showError('loginError', 'Por favor completa todos los campos');
                return;
            }
            
            createDemoUser();
            
            const usersData = getStorage('orbitUsers') || '[]';
            let users;
            try {
                users = JSON.parse(usersData);
            } catch (e) {
                users = [];
            }
            
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = user;
                setStorage('currentUser', JSON.stringify(user));
                
                if (user.email === 'demo@orbit.com') {
                    createDemoConversations();
                }
                
                showMainApp();
            } else {
                showError('loginError', 'Email o contrase√±a incorrectos');
            }
        }

        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.style.display = 'block';
                setTimeout(() => {
                    errorElement.style.display = 'none';
                }, 3000);
            }
        }

        async function showMainApp() {
            showScreen('mainScreen');
            loadProfile();
            requestLocation();
            updateChatBadge();
            
            // Inicializar sistema de notificaciones
            await initializeNotifications();
        }

        async function initializeNotifications() {
            // Registrar service worker
            await registerServiceWorker();
            
            // Cargar configuraci√≥n
            loadNotificationSettings();
            
            // Solicitar permisos si no est√°n concedidos
            if (Notification.permission === 'default') {
                setTimeout(async () => {
                    await requestNotificationPermission();
                }, 2000);
            } else if (Notification.permission === 'granted') {
                notificationPermission = 'granted';
                scheduleAutoNotifications();
                
                // Notificaci√≥n de bienvenida
                setTimeout(() => {
                    showNotification('üåå ¬°Bienvenido de vuelta!', {
                        body: 'Tienes nuevas personas esperando conectar contigo',
                        icon: 'üëã',
                        action: 'openMatch',
                        tag: 'welcome-back'
                    });
                }, 3000);
            }
        }

        function loadProfile() {
            if (!currentUser) return;
            
            document.getElementById('profileAvatar').textContent = 
                currentUser.firstName.charAt(0) + currentUser.lastName.charAt(0);
            document.getElementById('profileName').textContent = 
                `${currentUser.firstName} ${currentUser.lastName}`;
            document.getElementById('profileAge').textContent = `${currentUser.age} a√±os`;
            
            if (currentUser.personalityData) {
                const traitsDiv = document.getElementById('personalityTraits');
                traitsDiv.innerHTML = '';
                
                const traits = [
                    { name: 'Extraversi√≥n', value: currentUser.personalityData.extraversion || 50 },
                    { name: 'Apertura', value: currentUser.personalityData.openness || 50 },
                    { name: 'Consciencia', value: currentUser.personalityData.conscientiousness || 50 },
                    { name: 'Amabilidad', value: currentUser.personalityData.agreeableness || 50 },
                    { name: 'Estabilidad', value: currentUser.personalityData.stability || 50 }
                ];
                
                traits.forEach(trait => {
                    const traitDiv = document.createElement('div');
                    traitDiv.className = 'personality-trait';
                    traitDiv.innerHTML = `
                        <div class="trait-name">${trait.name}</div>
                        <div class="trait-bar">
                            <div class="trait-fill" style="width: ${trait.value}%"></div>
                        </div>
                        <div class="trait-value">${Math.round(trait.value)}</div>
                    `;
                    traitsDiv.appendChild(traitDiv);
                });
            }
            
            if (currentUser.insights) {
                const insightsDiv = document.getElementById('personalityInsights');
                insightsDiv.innerHTML = '';
                
                currentUser.insights.forEach(insight => {
                    const insightDiv = document.createElement('div');
                    insightDiv.className = 'insight-card';
                    insightDiv.innerHTML = `<div class="insight-text">${insight}</div>`;
                    insightsDiv.appendChild(insightDiv);
                });
            }
        }

        // ===== GEOLOCALIZACI√ìN =====
        async function requestLocation() {
            if (!navigator.geolocation) {
                showToast('‚ùå Error', 'Tu navegador no soporta geolocalizaci√≥n');
                return;
            }

            try {
                const position = await new Promise((resolve, reject) => {
                    navigator.geolocation.getCurrentPosition(resolve, reject, {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 300000
                    });
                });

                userLocation = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };

                // Simular reverse geocoding
                const locationName = await getLocationName(userLocation.lat, userLocation.lng);
                
                document.getElementById('locationText').textContent = `üìç ${locationName}`;
                
                // Actualizar distancias
                updateUserDistances();
                updateStats();
                generateConstellation();
                
                console.log('‚úÖ Ubicaci√≥n obtenida:', userLocation);
                
            } catch (error) {
                console.error('‚ùå Error obteniendo ubicaci√≥n:', error);
                document.getElementById('locationText').textContent = 'üìç L\'Hospitalet de Llobregat, Espa√±a';
                // Usar ubicaci√≥n por defecto
                userLocation = { lat: 41.3596, lng: 2.0994 };
                updateUserDistances();
                updateStats();
                generateConstellation();
            }
        }

        async function getLocationName(lat, lng) {
            // Simular API de geocoding
            const locations = [
                'L\'Hospitalet de Llobregat, Espa√±a',
                'Barcelona, Espa√±a', 
                'Sant Adri√† de Bes√≤s, Espa√±a',
                'Cornell√† de Llobregat, Espa√±a'
            ];
            
            return locations[Math.floor(Math.random() * locations.length)];
        }

        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371; // Radio de la Tierra en km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                    Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function updateUserDistances() {
            if (!userLocation) return;
            
            mockUsers.forEach(user => {
                user.distance = calculateDistance(
                    userLocation.lat, userLocation.lng,
                    user.location.lat, user.location.lng
                );
            });
            
            // Ordenar por distancia
            mockUsers.sort((a, b) => a.distance - b.distance);
        }

        // ===== SISTEMA DE SWIPE CARDS =====
        function initializeSwipeCards() {
            const container = document.getElementById('swipeContainer');
            
            if (!container) {
                console.error('‚ùå No se encontr√≥ el contenedor de swipe cards');
                return;
            }
            
            container.innerHTML = '';
            currentCardIndex = 0;
            
            // Filtrar usuarios por proximidad si hay ubicaci√≥n
            let availableUsers = [...mockUsers];
            if (userLocation) {
                availableUsers = mockUsers.filter(user => user.distance <= 10); // Dentro de 10km
            }
            
            if (availableUsers.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 100px 20px; color: #718096;">
                        <div style="font-size: 48px; margin-bottom: 20px;">üòî</div>
                        <p>No hay perfiles cerca de ti</p>
                        <button class="btn btn-secondary" onclick="initializeSwipeCards()" style="margin-top: 20px; padding: 12px 24px;">
                            üîÑ Buscar en toda la ciudad
                        </button>
                    </div>
                `;
                return;
            }
            
            // Show first 3 cards
            for (let i = 0; i < Math.min(3, availableUsers.length); i++) {
                createSwipeCard(availableUsers[i], i);
            }
        }

        function createSwipeCard(user, index) {
            const container = document.getElementById('swipeContainer');
            
            if (!container) return;
            
            const card = document.createElement('div');
            card.className = 'swipe-card';
            card.style.zIndex = 10 - index;
            card.style.transform = `scale(${1 - index * 0.05}) translateY(${index * 10}px)`;
            
            const connectionColors = {
                intellectual: 'linear-gradient(45deg, #4299e1, #63b3ed)',
                emotional: 'linear-gradient(45deg, #f56565, #fc8181)',
                creative: 'linear-gradient(45deg, #9f7aea, #b794f6)',
                balanced: 'linear-gradient(45deg, #48bb78, #68d391)'
            };
            
            card.innerHTML = `
                <div class="card-photo" style="background: ${connectionColors[user.connectionType]}">
                    ${user.initials}
                    ${user.verified ? '<div class="card-verification">‚úì Verificado</div>' : ''}
                    <div class="card-distance">${user.distance ? user.distance.toFixed(1) + ' km' : 'Cerca'}</div>
                </div>
                <div class="card-info">
                    <div class="card-name">${user.name}</div>
                    <div class="card-details">${user.age} a√±os ‚Ä¢ ${getConnectionTypeText(user.connectionType)}</div>
                    <div class="card-compatibility">${user.compatibility}% compatibilidad</div>
                    <div class="card-bio">${user.bio}</div>
                </div>
            `;
            
            container.appendChild(card);
            addSwipeGestures(card, user);
        }

        function getConnectionTypeText(type) {
            const types = {
                intellectual: 'Conexi√≥n intelectual',
                emotional: 'Conexi√≥n emocional', 
                creative: 'Conexi√≥n creativa',
                balanced: 'Conexi√≥n equilibrada'
            };
            return types[type] || 'Conexi√≥n especial';
        }

        function addSwipeGestures(card, user) {
            let startX = 0;
            let startY = 0;
            let currentX = 0;
            let currentY = 0;
            let isDragging = false;
            
            // Touch events for mobile
            card.addEventListener('touchstart', startDrag, { passive: false });
            card.addEventListener('mousedown', startDrag);
            
            function startDrag(e) {
                isDragging = true;
                const clientX = e.type === 'mousedown' ? e.clientX : e.touches[0].clientX;
                const clientY = e.type === 'mousedown' ? e.clientY : e.touches[0].clientY;
                startX = clientX;
                startY = clientY;
                card.style.transition = 'none';
                e.preventDefault();
            }
            
            document.addEventListener('touchmove', drag, { passive: false });
            document.addEventListener('mousemove', drag);
            
            function drag(e) {
                if (!isDragging) return;
                
                const clientX = e.type === 'mousemove' ? e.clientX : e.touches[0].clientX;
                const clientY = e.type === 'mousemove' ? e.clientY : e.touches[0].clientY;
                
                currentX = clientX - startX;
                currentY = clientY - startY;
                
                // Restricto el movimiento vertical
                const maxY = Math.abs(currentX) * 0.1;
                currentY = Math.max(-maxY, Math.min(maxY, currentY));
                
                const rotation = currentX * 0.1;
                
                card.style.transform = `translateX(${currentX}px) translateY(${currentY}px) rotate(${rotation}deg)`;
                
                if (currentX > 50) {
                    card.style.boxShadow = '0 10px 30px rgba(72, 187, 120, 0.3)';
                } else if (currentX < -50) {
                    card.style.boxShadow = '0 10px 30px rgba(245, 101, 101, 0.3)';
                } else {
                    card.style.boxShadow = '0 10px 30px rgba(0,0,0,0.2)';
                }
                
                e.preventDefault();
            }
            
            document.addEventListener('touchend', endDrag);
            document.addEventListener('mouseup', endDrag);
            
            function endDrag() {
                if (!isDragging) return;
                isDragging = false;
                
                card.style.transition = 'transform 0.3s ease, opacity 0.3s ease';
                
                if (currentX > 100) {
                    likeCard(user, card);
                } else if (currentX < -100) {
                    passCard(user, card);
                } else {
                    card.style.transform = 'translateX(0) translateY(0) rotate(0deg)';
                    card.style.boxShadow = '0 10px 30px rgba(0,0,0,0.2)';
                }
                
                currentX = 0;
                currentY = 0;
            }
        }

        function likeCard(user = null, card = null) {
            if (!card) {
                card = document.querySelector('.swipe-card');
                user = mockUsers[currentCardIndex];
            }
            
            card.classList.add('swiped-right');
            
            // Check for match (simulate 30% chance)
            if (Math.random() < 0.3) {
                setTimeout(() => showMatchModal(user), 500);
            }
            
            nextCard();
        }

        function passCard(user = null, card = null) {
            if (!card) {
                card = document.querySelector('.swipe-card');
            }
            
            card.classList.add('swiped-left');
            nextCard();
        }

        function superLikeCard() {
            const card = document.querySelector('.swipe-card');
            const user = mockUsers[currentCardIndex];
            
            card.style.transform = 'translateY(-100%) scale(0.8)';
            card.style.opacity = '0';
            
            // Super like has higher match chance (60%)
            if (Math.random() < 0.6) {
                setTimeout(() => showMatchModal(user), 500);
            }
            
            nextCard();
        }

        function nextCard() {
            setTimeout(() => {
                const oldCard = document.querySelector('.swipe-card');
                if (oldCard) oldCard.remove();
                
                currentCardIndex++;
                
                // Add new card to the stack
                if (currentCardIndex + 2 < mockUsers.length) {
                    createSwipeCard(mockUsers[currentCardIndex + 2], 2);
                }
                
                // Update remaining cards positions
                const remainingCards = document.querySelectorAll('.swipe-card');
                remainingCards.forEach((card, index) => {
                    card.style.zIndex = 10 - index;
                    card.style.transform = `scale(${1 - index * 0.05}) translateY(${index * 10}px)`;
                });
                
                if (currentCardIndex >= mockUsers.length) {
                    showNoMoreCards();
                }
            }, 300);
        }

        function showNoMoreCards() {
            const container = document.getElementById('swipeContainer');
            container.innerHTML = `
                <div style="text-align: center; padding: 100px 40px; color: #718096;">
                    <div style="font-size: 48px; margin-bottom: 20px;">üåü</div>
                    <h3 style="color: #4a5568; margin-bottom: 10px;">¬°Has visto todos los perfiles!</h3>
                    <p style="margin-bottom: 20px;">Vuelve m√°s tarde para ver nuevas conexiones potenciales.</p>
                    <button class="btn btn-primary" onclick="initializeSwipeCards()">
                        Ver de nuevo
                    </button>
                </div>
            `;
        }

        function showMatchModal(user) {
            // Mostrar notificaci√≥n de match
            if (notificationSettings.newMatches) {
                showNotification(`üéâ ¬°Es un Match!`, {
                    body: `Tienes ${user.compatibility}% compatibilidad con ${user.name}`,
                    icon: '‚ù§Ô∏è',
                    action: 'openChat',
                    data: { userId: user.id },
                    tag: `match-${user.id}`
                });
            }
            
            showToast(`üéâ ¬°Es un Match con ${user.name}!`, 'Puedes empezar a chatear inmediatamente');
            
            // Create conversation
            if (!conversations[user.id]) {
                conversations[user.id] = {
                    userId: user.id,
                    messages: [],
                    lastMessageTime: new Date().toISOString(),
                    unreadCount: 0
                };
                setStorage('conversations', JSON.stringify(conversations));
                updateChatBadge();
            }
        }

        // ===== SISTEMA DE CHAT =====
        function updateConversationsList() {
            const conversationsList = document.getElementById('conversationsList');
            conversationsList.innerHTML = '';

            if (Object.keys(conversations).length === 0) {
                conversationsList.innerHTML = `
                    <div style="text-align: center; padding: 60px 40px; color: #718096;">
                        <div style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;">üí¨</div>
                        <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 10px; color: #4a5568;">¬°Hora de romper el hielo!</h3>
                        <p style="font-size: 14px; line-height: 1.5; margin-bottom: 20px;">
                            Tus matches est√°n esperando. Ve a descubrir y env√≠a el primer mensaje.
                        </p>
                        <button class="btn btn-primary" onclick="showScreen('discoverScreen')" style="padding: 12px 24px; font-size: 14px;">
                            Descubrir personas
                        </button>
                    </div>
                `;
                return;
            }

            const sortedConversations = Object.values(conversations)
                .sort((a, b) => new Date(b.lastMessageTime) - new Date(a.lastMessageTime));

            sortedConversations.forEach(conversation => {
                const user = mockUsers.find(u => u.id === conversation.userId);
                if (!user) return;

                const conversationItem = createConversationItem(user, conversation);
                conversationsList.appendChild(conversationItem);
            });
        }

        function createConversationItem(user, conversation) {
            const item = document.createElement('div');
            item.className = `conversation-item ${conversation.unreadCount > 0 ? 'unread' : ''}`;
            
            const connectionColors = {
                intellectual: 'linear-gradient(45deg, #4299e1, #63b3ed)',
                emotional: 'linear-gradient(45deg, #f56565, #fc8181)',
                creative: 'linear-gradient(45deg, #9f7aea, #b794f6)',
                balanced: 'linear-gradient(45deg, #48bb78, #68d391)'
            };

            const lastMessage = conversation.messages[conversation.messages.length - 1];
            const timeAgo = getTimeAgo(new Date(conversation.lastMessageTime));

            item.innerHTML = `
                <div class="conversation-avatar" style="background: ${connectionColors[user.connectionType]}">
                    ${user.initials}
                    ${user.verified ? '<div class="verified-badge">‚úì</div>' : ''}
                </div>
                <div class="conversation-info">
                    <div class="conversation-name">
                        ${user.name}
                        <span class="compatibility-chip">${user.compatibility}%</span>
                        ${user.isOnline ? '<span style="color: #48bb78; font-size: 10px;">‚óè</span>' : ''}
                    </div>
                    <div class="conversation-preview">
                        ${lastMessage ? (lastMessage.isOwn ? 'T√∫: ' : '') + lastMessage.text : 'Nueva conversaci√≥n'}
                    </div>
                </div>
                <div class="conversation-meta">
                    <div class="conversation-time">${timeAgo}</div>
                    ${conversation.unreadCount > 0 ? `<div class="unread-badge">${conversation.unreadCount}</div>` : ''}
                </div>
            `;

            item.addEventListener('click', () => {
                openIndividualChat(user.id);
            });

            return item;
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return 'Ahora';
            if (diffMins < 60) return `${diffMins}m`;
            if (diffHours < 24) return `${diffHours}h`;
            if (diffDays < 7) return `${diffDays}d`;
            return 'Hace mucho';
        }

        function openIndividualChat(userId) {
            currentChatUserId = userId;
            const user = mockUsers.find(u => u.id === userId);
            if (!user) return;

            // Mark conversation as read
            if (conversations[userId]) {
                conversations[userId].unreadCount = 0;
                setStorage('conversations', JSON.stringify(conversations));
                updateChatBadge();
            }

            setupChatHeader(user);
            loadChatMessages(userId);
            showScreen('individualChatScreen');
        }

        function setupChatHeader(user) {
            const connectionColors = {
                intellectual: 'linear-gradient(45deg, #4299e1, #63b3ed)',
                emotional: 'linear-gradient(45deg, #f56565, #fc8181)',
                creative: 'linear-gradient(45deg, #9f7aea, #b794f6)',
                balanced: 'linear-gradient(45deg, #48bb78, #68d391)'
            };

            const avatar = document.getElementById('chatUserAvatar');
            avatar.style.background = connectionColors[user.connectionType];
            avatar.textContent = user.initials;
            
            // Add verification badge if verified
            if (user.verified) {
                avatar.innerHTML = `${user.initials}<div class="verified-badge">‚úì</div>`;
            }
            
            document.getElementById('chatUserName').textContent = user.name;
            
            const statusElement = document.getElementById('chatUserStatus');
            if (user.isOnline) {
                statusElement.innerHTML = '<span class="online-dot"></span>En l√≠nea';
                statusElement.style.color = '#718096';
            } else {
                statusElement.innerHTML = 'Desconectado';
                statusElement.style.color = '#a0aec0';
            }
        }

        function loadChatMessages(userId) {
            const messagesContainer = document.getElementById('chatMessagesContainer');
            messagesContainer.innerHTML = '';

            if (!conversations[userId] || !conversations[userId].messages || conversations[userId].messages.length === 0) {
                messagesContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: #718096;">
                        <div style="font-size: 32px; margin-bottom: 15px;">üëã</div>
                        <p style="margin-bottom: 15px;">¬°Es hora de romper el hielo!</p>
                        <button class="btn btn-primary" onclick="sendIcebreaker()" style="padding: 12px 24px; font-size: 14px;">
                            Enviar icebreaker sugerido
                        </button>
                    </div>
                `;
                return;
            }

            conversations[userId].messages.forEach(message => {
                const messageElement = createMessageElement(message);
                messagesContainer.appendChild(messageElement);
            });

            scrollToBottom();
        }

        function createMessageElement(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message-bubble ' + (message.isOwn ? 'own' : 'other');
            
            const messageTime = new Date(message.timestamp);
            const timeString = messageTime.toLocaleTimeString('es-ES', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });

            let statusIcon = '';
            if (message.isOwn && message.status) {
                statusIcon = message.status === 'read' ? '‚úì‚úì' : message.status === 'delivered' ? '‚úì' : '‚è±';
            }

            messageDiv.innerHTML = `
                ${message.text}
                <div class="message-time ${message.isOwn ? '' : 'other'}">
                    ${timeString}
                    ${message.isOwn ? `<span class="message-status">${statusIcon}</span>` : ''}
                </div>
            `;

            return messageDiv;
        }

        function scrollToBottom() {
            const messagesContainer = document.getElementById('chatMessagesContainer');
            setTimeout(() => {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 100);
        }

        function sendIcebreaker() {
            const user = mockUsers.find(u => u.id === currentChatUserId);
            if (!user) return;
            
            const icebreaker = user.icebreaker;
            
            if (!conversations[currentChatUserId]) {
                conversations[currentChatUserId] = {
                    userId: currentChatUserId,
                    messages: [],
                    lastMessageTime: new Date().toISOString(),
                    unreadCount: 0
                };
            }
            
            const newMessage = {
                id: 'icebreaker_' + Date.now(),
                text: icebreaker,
                isOwn: true,
                timestamp: new Date().toISOString(),
                read: true,
                status: 'delivered'
            };
            
            conversations[currentChatUserId].messages.push(newMessage);
            conversations[currentChatUserId].lastMessageTime = newMessage.timestamp;
            
            setStorage('conversations', JSON.stringify(conversations));
            
            loadChatMessages(currentChatUserId);
            
            setTimeout(() => {
                simulateAutoResponse();
            }, 2000);
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const messageText = input.value.trim();
            
            if (!messageText || !currentChatUserId) return;

            const newMessage = {
                id: 'msg_' + Date.now(),
                text: messageText,
                isOwn: true,
                timestamp: new Date().toISOString(),
                read: true,
                status: 'sending'
            };

            if (!conversations[currentChatUserId]) {
                conversations[currentChatUserId] = {
                    userId: currentChatUserId,
                    messages: [],
                    lastMessageTime: new Date().toISOString(),
                    unreadCount: 0
                };
            }

            conversations[currentChatUserId].messages.push(newMessage);
            conversations[currentChatUserId].lastMessageTime = newMessage.timestamp;

            setStorage('conversations', JSON.stringify(conversations));

            const messageElement = createMessageElement(newMessage);
            document.getElementById('chatMessagesContainer').appendChild(messageElement);

            input.value = '';
            adjustTextareaHeight(input);
            scrollToBottom();

            // Update status to delivered
            setTimeout(() => {
                newMessage.status = 'delivered';
                setStorage('conversations', JSON.stringify(conversations));
                const statusSpan = messageElement.querySelector('.message-status');
                if (statusSpan) statusSpan.textContent = '‚úì';
            }, 1000);

            // Simulate read after 3 seconds
            setTimeout(() => {
                newMessage.status = 'read';
                setStorage('conversations', JSON.stringify(conversations));
                const statusSpan = messageElement.querySelector('.message-status');
                if (statusSpan) statusSpan.textContent = '‚úì‚úì';
            }, 3000);

            simulateAutoResponse();
        }

        function simulateAutoResponse() {
            if (!currentChatUserId || !aiResponses[currentChatUserId]) return;

            setTimeout(() => {
                const responses = aiResponses[currentChatUserId];
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                
                const autoMessage = {
                    id: 'auto_' + Date.now(),
                    text: randomResponse,
                    isOwn: false,
                    timestamp: new Date().toISOString(),
                    read: false,
                    status: 'delivered'
                };

                conversations[currentChatUserId].messages.push(autoMessage);
                conversations[currentChatUserId].lastMessageTime = autoMessage.timestamp;
                setStorage('conversations', JSON.stringify(conversations));

                const messageElement = createMessageElement(autoMessage);
                document.getElementById('chatMessagesContainer').appendChild(messageElement);
                scrollToBottom();

                // Mostrar notificaci√≥n si no estamos en el chat
                const currentScreen = document.querySelector('.screen.active');
                if (!currentScreen || currentScreen.id !== 'individualChatScreen') {
                    const user = mockUsers.find(u => u.id === currentChatUserId);
                    if (user && notificationSettings.newMessages) {
                        showNotification(`üí¨ ${user.name}`, {
                            body: randomResponse.length > 50 ? randomResponse.substring(0, 50) + '...' : randomResponse,
                            icon: 'üí¨',
                            action: 'openChat',
                            data: { userId: currentChatUserId },
                            tag: `message-${currentChatUserId}`
                        });
                    }
                }

                setTimeout(() => {
                    autoMessage.read = true;
                    setStorage('conversations', JSON.stringify(conversations));
                }, 2000);

            }, Math.random() * 2000 + 2000);
        }

        function adjustTextareaHeight(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 80) + 'px';
        }

        // ===== CONSTELACI√ìN =====
        function generateConstellation() {
            const container = document.getElementById('constellationContainer');
            container.querySelectorAll('.match-node').forEach(node => node.remove());

            const centerX = 175;
            const centerY = 175;

            mockUsers.forEach((user, index) => {
                const compatibilityRadius = 120 - (user.compatibility / 100) * 80;
                const angle = (index * (360 / mockUsers.length)) * (Math.PI / 180);
                
                const x = centerX + compatibilityRadius * Math.cos(angle);
                const y = centerY + compatibilityRadius * Math.sin(angle);

                const node = createMatchNode(user, x, y);
                container.appendChild(node);
            });
        }

        function createMatchNode(user, x, y) {
            const node = document.createElement('div');
            node.className = `match-node ${user.connectionType}`;
            node.style.left = (x - 20) + 'px';
            node.style.top = (y - 20) + 'px';
            
            node.innerHTML = `
                ${user.initials}
                <div class="compatibility-badge">${getCompatibilityEmoji(user.compatibility)}</div>
                ${user.distance ? `<div class="distance-badge">${user.distance.toFixed(1)}km</div>` : ''}
                ${user.verified ? '<div class="verified-badge">‚úì</div>' : ''}
                ${user.isOnline ? '<div class="online-indicator"></div>' : ''}
            `;

            node.addEventListener('click', () => {
                showUserProfileModal(user);
            });
            
            return node;
        }

        function showUserProfileModal(user) {
            const userInfo = `
üåü ${user.name}, ${user.age} a√±os
${user.verified ? '‚úÖ Verificado' : '‚ùå No verificado'}
üìç ${user.distance ? user.distance.toFixed(1) + ' km de ti' : 'Ubicaci√≥n no disponible'}
üí´ ${user.compatibility}% compatibilidad

${user.bio}

¬øTe gustar√≠a conectar con ${user.name}?
            `;
            
            if (confirm(userInfo)) {
                // Create conversation if doesn't exist
                if (!conversations[user.id]) {
                    conversations[user.id] = {
                        userId: user.id,
                        messages: [],
                        lastMessageTime: new Date().toISOString(),
                        unreadCount: 0
                    };
                    setStorage('conversations', JSON.stringify(conversations));
                }
                
                openIndividualChat(user.id);
            }
        }

        function getCompatibilityEmoji(score) {
            if (score >= 90) return 'üî•';
            if (score >= 80) return '‚≠ê';
            if (score >= 70) return '‚ú®';
            return 'üí´';
        }

        function updateStats() {
            const onlineUsers = mockUsers.filter(user => user.isOnline);
            const nearbyUsers = userLocation ? mockUsers.filter(user => user.distance && user.distance <= 5) : mockUsers;
            const avgCompatibility = Math.round(
                mockUsers.reduce((sum, user) => sum + user.compatibility, 0) / mockUsers.length
            );

            document.getElementById('totalMatches').textContent = mockUsers.length;
            document.getElementById('avgCompatibility').textContent = avgCompatibility;
            document.getElementById('nearbyCount').textContent = nearbyUsers.length;
        }

        // ===== FUNCIONES AUXILIARES =====
        function updateChatBadge() {
            const badge = document.getElementById('chatNotificationBadge');
            let totalUnread = 0;
            
            Object.values(conversations).forEach(conversation => {
                totalUnread += conversation.unreadCount || 0;
            });
            
            // Simular algunos mensajes no le√≠dos para demo
            totalUnread += Math.floor(Math.random() * 2) + 1;
            
            if (totalUnread > 0) {
                badge.textContent = totalUnread > 99 ? '99+' : totalUnread;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }

        function simulateVerification() {
            if (!currentUser) return;
            
            showToast('üõ°Ô∏è Verificando...', 'Procesando tu verificaci√≥n de perfil...');
            
            setTimeout(() => {
                currentUser.verified = true;
                setStorage('currentUser', JSON.stringify(currentUser));
                updateVerificationStatus();
                
                showNotification('üõ°Ô∏è ¬°Perfil verificado!', {
                    body: 'Tu perfil ha sido verificado exitosamente',
                    icon: '‚úÖ',
                    tag: 'profile-verified'
                });
                
                showToast('üéâ ¬°Verificado!', 'Tu perfil ha sido verificado exitosamente');
            }, 3000);
        }

        function updateVerificationStatus() {
            const statusElement = document.getElementById('verificationStatus');
            
            if (currentUser && currentUser.verified) {
                statusElement.textContent = '‚úÖ Verificado';
                statusElement.style.background = '#c6f6d5';
                statusElement.style.color = '#22543d';
            }
        }

        function logout() {
            currentUser = null;
            conversations = {};
            currentChatUserId = null;
            userLocation = null;
            setStorage('currentUser', 'null');
            showScreen('loginScreen');
        }

        function directLogin() {
            const demoUser = createDemoUser();
            currentUser = demoUser;
            setStorage('currentUser', JSON.stringify(demoUser));
            createDemoConversations();
            showMainApp();
        }

        function premiumLogin() {
            const demoUser = createDemoUser();
            demoUser.subscriptionType = 'premium';
            demoUser.verified = true;
            
            let usersData = getStorage('orbitUsers') || '[]';
            let users;
            try {
                users = JSON.parse(usersData);
            } catch (e) {
                users = [];
            }
            const userIndex = users.findIndex(u => u.email === demoUser.email);
            if (userIndex >= 0) {
                users[userIndex] = demoUser;
            } else {
                users.push(demoUser);
            }
            setStorage('orbitUsers', JSON.stringify(users));
            
            currentUser = demoUser;
            setStorage('currentUser', JSON.stringify(demoUser));
            createDemoConversations();
            showMainApp();
        }

        // ===== INICIALIZACI√ìN =====
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üåå Orbit PWA iniciando...');
            
            createDemoUser();
            
            // Load saved data
            const savedConversations = getStorage('conversations');
            if (savedConversations && savedConversations !== 'null') {
                try {
                    conversations = JSON.parse(savedConversations);
                } catch (e) {
                    conversations = {};
                }
            }
            
            // Inicializar permisos de notificaci√≥n
            if ('Notification' in window) {
                notificationPermission = Notification.permission;
            }
            
            // PWA Event Listeners
            const installPwaBtn = document.getElementById('installPwaBtn');
            if (installPwaBtn) {
                installPwaBtn.addEventListener('click', installPWA);
            }
            
            // Event listeners
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const submitBtn = document.getElementById('loginBtn');
                    const originalText = submitBtn.innerHTML;
                    submitBtn.innerHTML = '<div class="loading-spinner"></div>';
                    submitBtn.disabled = true;
                    
                    setTimeout(() => {
                        executeLogin();
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                    }, 500);
                });

                // Demo buttons
                const demoButton = document.createElement('button');
                demoButton.type = 'button';
                demoButton.className = 'btn btn-secondary';
                demoButton.textContent = 'üé≠ Login Demo R√°pido';
                demoButton.addEventListener('click', directLogin);
                loginForm.appendChild(demoButton);

                const premiumDemoButton = document.createElement('button');
                premiumDemoButton.type = 'button';
                premiumDemoButton.className = 'btn btn-premium';
                premiumDemoButton.textContent = 'üëë Demo Premium + Verificado';
                premiumDemoButton.addEventListener('click', premiumLogin);
                loginForm.appendChild(premiumDemoButton);
            }

            // Navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    const tab = this.getAttribute('data-tab');
                    if (tab) showScreen(tab);
                });
            });

            // Chat functionality
            const backToChatBtn = document.getElementById('backToChatBtn');
            if (backToChatBtn) {
                backToChatBtn.addEventListener('click', () => {
                    showScreen('chatScreen');
                    currentChatUserId = null;
                });
            }

            const chatInput = document.getElementById('chatInput');
            const chatSendBtn = document.getElementById('chatSendBtn');
            const videoCallBtn = document.getElementById('videoCallBtn');

            if (chatSendBtn) {
                chatSendBtn.addEventListener('click', sendMessage);
            }

            if (videoCallBtn) {
                videoCallBtn.addEventListener('click', () => {
                    showToast('üìπ Video llamada', 'Funci√≥n pr√≥ximamente disponible');
                });
            }
            
            if (chatInput) {
                chatInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage();
                    }
                });

                chatInput.addEventListener('input', function() {
                    adjustTextareaHeight(this);
                    
                    if (chatSendBtn) {
                        const isDisabled = !this.value.trim();
                        chatSendBtn.disabled = isDisabled;
                        chatSendBtn.style.opacity = isDisabled ? '0.5' : '1';
                        chatSendBtn.style.transform = isDisabled ? 'scale(0.9)' : 'scale(1)';
                    }
                });

                if (chatSendBtn) {
                    chatSendBtn.disabled = true;
                    chatSendBtn.style.opacity = '0.5';
                    chatSendBtn.style.transform = 'scale(0.9)';
                }
            }

            // Logout
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', logout);
            }

            // Check for saved user
            const savedUser = getStorage('currentUser');
            if (savedUser && savedUser !== 'null') {
                try {
                    currentUser = JSON.parse(savedUser);
                    if (currentUser && currentUser.personalityData) {
                        if (currentUser.email === 'demo@orbit.com') {
                            createDemoConversations();
                        }
                        setTimeout(() => {
                            showMainApp();
                        }, 500);
                    }
                } catch (e) {
                    console.log('Error loading saved user:', e);
                }
            }

            console.log('‚úÖ Orbit PWA listo');
            console.log('üöÄ Funcionalidades implementadas:');
            console.log('  üì± Progressive Web App (PWA) completa');
            console.log('  üîî Sistema completo de notificaciones push');
            console.log('  üì± Instalable en m√≥vil como app nativa');
            console.log('  üéØ Optimizaci√≥n m√≥vil con gestos touch');
            console.log('  üìç Geolocalizaci√≥n y matches por proximidad');
            console.log('  üí¨ Chat completo con estados');
            console.log('  üåå Constelaci√≥n interactiva');
        });
    </script>
</body>
</html>